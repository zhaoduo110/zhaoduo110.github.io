<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ClickHouse-评估与测试 | Yet</title><meta name="description" content="OLTP和OLAPOLTP 联机事务处理 OLAP（On-line Analytical Processing，联机分析处理）是在基于数据仓库多维模型的基础上实现的面向分析的各类操作的集合 OLAP特征  绝大多数是读请求 数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。 已添加到数据库的数据不能修改。 对于读取，从数据库中提取相当多的行，但只提取列的一小部分。"><meta name="keywords" content="SQL,ClickHouse"><meta name="author" content="Mr、 Zhao"><meta name="copyright" content="Mr、 Zhao"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="ClickHouse-评估与测试"><meta name="twitter:description" content="OLTP和OLAPOLTP 联机事务处理 OLAP（On-line Analytical Processing，联机分析处理）是在基于数据仓库多维模型的基础上实现的面向分析的各类操作的集合 OLAP特征  绝大多数是读请求 数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。 已添加到数据库的数据不能修改。 对于读取，从数据库中提取相当多的行，但只提取列的一小部分。"><meta name="twitter:image" content="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/5a27d7aa3c85b.jpg"><meta property="og:type" content="article"><meta property="og:title" content="ClickHouse-评估与测试"><meta property="og:url" content="https://zhaoduo110.github.io/posts/de4dfb7d.html"><meta property="og:site_name" content="Yet"><meta property="og:description" content="OLTP和OLAPOLTP 联机事务处理 OLAP（On-line Analytical Processing，联机分析处理）是在基于数据仓库多维模型的基础上实现的面向分析的各类操作的集合 OLAP特征  绝大多数是读请求 数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。 已添加到数据库的数据不能修改。 对于读取，从数据库中提取相当多的行，但只提取列的一小部分。"><meta property="og:image" content="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/5a27d7aa3c85b.jpg"><meta property="article:published_time" content="2021-03-30T07:17:34.000Z"><meta property="article:modified_time" content="2021-09-16T03:11:18.346Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://zhaoduo110.github.io/posts/de4dfb7d.html"><link rel="prev" title="MySQL知识梳理-8.MySQL变量" href="https://zhaoduo110.github.io/posts/e674ae5a.html"><link rel="next" title="MySQL知识梳理-7.SQL优化-索引" href="https://zhaoduo110.github.io/posts/eea2a833.html"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.gif" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">41</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">25</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#OLTP和OLAP"><span class="toc-number">1.</span> <span class="toc-text">OLTP和OLAP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#区别"><span class="toc-number">1.1.</span> <span class="toc-text">区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OLAP引擎的常见操作"><span class="toc-number">1.2.</span> <span class="toc-text">OLAP引擎的常见操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OLAP分类"><span class="toc-number">1.3.</span> <span class="toc-text">OLAP分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#传统数仓与离线计算的弊端"><span class="toc-number">1.4.</span> <span class="toc-text">传统数仓与离线计算的弊端</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ClickHouse"><span class="toc-number">2.</span> <span class="toc-text">ClickHouse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#特性"><span class="toc-number">2.1.</span> <span class="toc-text">特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缺点"><span class="toc-number">2.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用场景"><span class="toc-number">2.3.</span> <span class="toc-text">使用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#测试"><span class="toc-number">2.4.</span> <span class="toc-text">测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导入文件数据"><span class="toc-number">2.4.1.</span> <span class="toc-text">导入文件数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#查询"><span class="toc-number">2.4.2.</span> <span class="toc-text">查询</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/5a27d7aa3c85b.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Yet</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">ClickHouse-评估与测试</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-03-30 15:17:34"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2021-03-30</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-09-16 11:11:18"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2021-09-16</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/SQL/">SQL</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="OLTP和OLAP"><a href="#OLTP和OLAP" class="headerlink" title="OLTP和OLAP"></a>OLTP和OLAP</h1><p>OLTP 联机事务处理</p>
<p>OLAP（On-line Analytical Processing，联机分析处理）是在基于数据仓库多维模型的基础上实现的面向分析的各类操作的集合</p>
<p><strong>OLAP特征</strong></p>
<ul>
<li>绝大多数是读请求</li>
<li>数据以相当大的批次(&gt; 1000行)更新，而不是单行更新;或者根本没有更新。</li>
<li>已添加到数据库的数据不能修改。</li>
<li>对于读取，从数据库中提取相当多的行，但只提取列的一小部分。</li>
<li>宽表，即每个表包含着大量的列</li>
<li>查询相对较少(通常每台服务器每秒查询数百次或更少)</li>
<li>对于简单查询，允许延迟大约50毫秒</li>
<li>列中的数据相对较小：数字和短字符串(例如，每个URL 60个字节)</li>
<li>处理单个查询时需要高吞吐量(每台服务器每秒可达数十亿行)</li>
<li>事务不是必须的</li>
<li>对数据一致性要求低</li>
<li>每个查询有一个大表。除了他以外，其他的都很小。</li>
<li>查询结果明显小于源数据。换句话说，数据经过过滤或聚合，因此结果适合于单个服务器的RAM中</li>
</ul>
<h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><table>
<thead>
<tr>
<th></th>
<th>OLTP</th>
<th>OLAP</th>
</tr>
</thead>
<tbody><tr>
<td>主要使用场景</td>
<td>在线业务服务</td>
<td>数据分析、挖掘、机器学习</td>
</tr>
<tr>
<td>涉及数据量</td>
<td>当前正在发生的业务数据</td>
<td>历史存档数据，时间跨度可能比较大</td>
</tr>
<tr>
<td>事务和数据完整性</td>
<td>对事务和数据一致性要求比较高</td>
<td>对事务能力没有要求，数据不一致也能重建数据</td>
</tr>
<tr>
<td>功能使用需求</td>
<td>简单的增删改查，要求响应时间极端(ms)</td>
<td>复杂的聚合和多数据源关联；查询执行时间可到分钟、小时、天级别</td>
</tr>
<tr>
<td>并发要求</td>
<td>高并发</td>
<td>低并发</td>
</tr>
<tr>
<td>技术实现方案</td>
<td>事务、索引、存储计算在一起</td>
<td>大量SCAN，列式存储，存储计算可以分开</td>
</tr>
<tr>
<td>可用性要求</td>
<td>非常高</td>
<td>要求不高</td>
</tr>
<tr>
<td>数据模型 / 规范</td>
<td>关系模型、3NF范式</td>
<td>维度模型，关系模型，对范式要求极低</td>
</tr>
<tr>
<td>技术典范</td>
<td>MySQL，Oracle</td>
<td>SQL-On-Hadoop</td>
</tr>
</tbody></table>
<h2 id="OLAP引擎的常见操作"><a href="#OLAP引擎的常见操作" class="headerlink" title="OLAP引擎的常见操作"></a>OLAP引擎的常见操作</h2><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/v2-8e425f14e379a909fc37c8c81fa1949e_720w.jpg" alt="img"></p>
<ul>
<li>上卷（Roll Up）/聚合：选定某些维度，根据这些维度来聚合事实，如果用SQL来表达就是select dim_a, aggs_func(fact_b) from fact_table group by dim_a.</li>
<li>下钻（Drill Down）：上卷和下钻是相反的操作。它是选定某些维度，将这些维度拆解出小的维度（如年拆解为月，省份拆解为城市），之后聚合事实。</li>
<li>切片（Slicing、Dicing）：选定某些维度，并根据特定值过滤这些维度的值，将原来的大Cube切成小cube。如dim_a in (‘CN’, ‘USA’)</li>
<li>旋转（Pivot/Rotate）：维度位置的互换。</li>
</ul>
<h2 id="OLAP分类"><a href="#OLAP分类" class="headerlink" title="OLAP分类"></a>OLAP分类</h2><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/20210406165524.png" alt=""></p>
<p><strong>ROLAP：关系型 OLAP ( Relational OLAP )</strong></p>
<p>典型代表是：Presto，Impala，GreenPlum，Clickhouse，Elasticsearch，Hive，Spark SQL，Flink SQL</p>
<p>数据写入时，ROLAP并未使用像MOLAP那样的预聚合技术；ROLAP收到Query请求时，会先解析Query，生成执行计划，扫描数据，执行关系型算子，在原始数据上做过滤(Where)、聚合(Sum, Avg, Count)、关联(Join)，分组（Group By)、排序（Order By）等，最后将结算结果返回给用户，整个过程都是即时计算，没有预先聚合好的数据可供优化查询速度，拼的都是资源和算力的大小。</p>
<p><strong>优点：</strong>ROLAP 不需要进行数据预处理 ( pre-processing )，因此查询灵活，可扩展性好。这类引擎使用 MPP 架构 ( 与Hadoop相似的大型并行处理架构，可以通过扩大并发来增加计算资源 )，可以高效处理大量数据。</p>
<p><strong>缺点：</strong>当数据量较大或 query 较为复杂时，查询性能也无法像 MOLAP 那样稳定。所有计算都是即时触发 ( 没有预处理 )，因此会耗费更多的计算资源，带来潜在的重复计算。</p>
<p>因此，ROLAP 适用于对查询模式不固定、查询灵活性要求高的场景。如数据分析师常用的数据分析类产品，他们往往会对数据做各种预先不能确定的分析，所以需要更高的查询灵活性。</p>
<p><strong>MOLAP：多维 OLAP ( Multi-dimensional OLAP )</strong></p>
<p>典型代表是：Druid，Kylin，Doris</p>
<p>一般会根据用户定义的数据维度、度量（也可以叫指标）在数据写入时生成预聚合数据，Query查询到来时，实际上查询的是预聚合的数据而不是原始明细数据，在查询模式相对固定的场景中，这种优化提速很明显</p>
<p><strong>优点：</strong>数据预处理，将原始数据按照指定的计算规则预先做聚合计算，这样避免了查询过程中出现大量的及时计算，提升了查询性能。</p>
<p><strong>缺点：</strong>这样的预聚合处理，需要预先定义维度，会限制后期数据查询的灵活性；如果查询工作涉及新的指标，需要重新增加预处理流程，损失了灵活度，存储成本也很高；同时，这种方式不支持明细数据的查询，仅适用于聚合型查询（如：sum，avg，count）</p>
<p>因此，MOLAP 适用于查询场景相对固定并且对查询性能要求非常高的场景。如广告主经常使用的广告投放报表分析</p>
<p>*<em>HOLAP：混合 OLAP ( Hybrid OLAP ) *</em></p>
<p>混合 OLAP，是 MOLAP 和 ROLAP 的一种融合。当查询聚合性数据的时候，使用MOLAP 技术；当查询明细数据时，使用 ROLAP 技术。在给定使用场景的前提下，以达到查询性能的最优化。</p>
<p>国内外有一些闭源的商业OLAP引擎，使用的公司不多并且源码不可见、资料少，很难分析学习其中的源码和技术点。在一二线的互联网公司中，应用较为广泛的还是上面提到的各种OLAP引擎</p>
<h2 id="传统数仓与离线计算的弊端"><a href="#传统数仓与离线计算的弊端" class="headerlink" title="传统数仓与离线计算的弊端"></a>传统数仓与离线计算的弊端</h2><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210409175547296.png" alt="image-20210409175547296"></p>
<ol>
<li><p>时效性低</p>
<p>对于音乐服务来说，实时下钻和分析PV、UV，用户圈层、歌曲的种类、DAU等数据，分析结果的价值取决于时效性。核心日报与统计报表场景下，基于Hive的离线分析仅能满足T+1的时效，对于实时日报和分析的需求越来越强烈。</p>
</li>
<li><p>易用性低</p>
<p>基于Hive离线数据分析平台，对于产品、运营、市场人员具有较高的技术门槛，无法满足自助的实时交互式分析需求；开发在上报和提取分析数据时，无法实时获取和验证结果，查询和分析日志经常需要几个小时。</p>
</li>
<li><p>流程效率低</p>
<p>数据分析需求，需由数据分析团队完成，经过排期、沟通、建模、分析、可视化等流程步骤，所需时间以周计算，落地可能达数周，分析结果不及时，影响和拖慢了决策进度。</p>
</li>
</ol>
<p>为了应对以上问题，提升流程效率，提高数据分析处理的时效性和易用性，数据的即席分析和<a href="https://cloud.tencent.com/product/yuntu?from=10680" target="_blank" rel="noopener">数据可视化</a>能力支撑需要优化和提升，让问题秒级有响应，分析更深入，数据分析更高效。</p>
<h1 id="ClickHouse"><a href="#ClickHouse" class="headerlink" title="ClickHouse"></a>ClickHouse</h1><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>真正的面向列的DBMS。（ClickHouse是一个DBMS,而不是一个单一的数据库。它允许在运行时创建表和数据库、加载数据和运行查询，而无需重新配置和重新启动服务器）</li>
<li>数据压缩。（一些面向列的DBMS（INFINIDB CE 和 MonetDB）不使用数据压缩。但是，数据压缩确实是提高了性能）</li>
<li>磁盘存储的数据。（许多面向列的DBMS(SPA HANA和GooglePowerDrill)）只能在内存中工作。但即使在数千台服务器上，内存也太小了。）</li>
<li>多核并行处理。(多核多节点并行化大型查询)</li>
<li>分布式处理。(在clickhouse中，数据可以驻留在不同的分片上。每个分片都可以用于容错的一组副本，查询会在所有分片上并行处理)</li>
<li>SQL支持。(ClickHouse sql 跟真正的sql有不一样的函数名称。不过语法基本跟SQL语法兼容，支持JOIN/FROM/IN 和JOIN子句及标量子查询支持子查询)</li>
<li>向量化引擎。(数据不仅按列式存储，而且由矢量-列的部分进行处理，这使得开发者能够实现高CPU性能)</li>
<li>实时数据更新。(ClickHouse支持主键表。为了快速执行对主键范围的查询，数据使用合并树(MergeTree)进行递增排序。由于这个原因，数据可以不断地添加到表中)</li>
<li>支持近似计算。(统计全国到底有多少人?143456754 14.3E)</li>
<li>数据复制和对数据完整性的支持。(ClickHouse使用异步多主复制。写入任何可用的复本后，数据将分发到所有剩余的副本。系统在不同的副本上保持相同的数据。数据在失败后自动恢复)</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li>没有完整的事务支持，不支持Transaction，想快就别Transaction</li>
<li>稀疏索引使得ClickHouse不适合通过其键检索单行的点查询</li>
<li>缺少完整的Update/Delete操作，缺少高频率、低延迟的修改或删除已存在数据的能力，仅用于批量删除或修改数据</li>
<li>聚合结果必须小于一台机器的内存大小</li>
<li>支持有限操作系统，正在慢慢完善</li>
<li>不适合Key-value存储，不支持Blob等文档型数据库</li>
<li>并发能力低，建议1000左右并发使用，数据量太大最多支持100</li>
</ul>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>ClickHouse对大数据量的聚合分析处理速度很快，但并发能力很低，建议1000左右并发使用，数据量太大最多支持100</p>
<p><strong>适用场景</strong></p>
<ol>
<li>web和app数据分析</li>
<li>广告网络和RTB</li>
<li>电信</li>
<li>电子商务和金融</li>
<li>信息安全</li>
<li>监测</li>
<li>时序数据</li>
<li>商业智能</li>
<li>在线游戏</li>
<li>物联网</li>
</ol>
<p>  <strong>不适用场景</strong></p>
<ol>
<li>事务性工作(OLTP)</li>
<li>高并发的键值访问</li>
<li>文档存储</li>
<li>超标准化的数据</li>
</ol>
<p><strong>行业用户及使用场景</strong></p>
<p><a href="https://clickhouse.tech/docs/zh/introduction/adopters/" target="_blank" rel="noopener">ClickHouse用户 | ClickHouse文档</a></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>测试服务器配置 2核4G</p>
<p>使用官方测试数据</p>
<p><strong>数据说明</strong></p>
<p>visits_v1：1679791。预先构建的会话</p>
<p>hits_v1：8873898 。所有用户在服务所涵盖的所有网站上完成的每个操作</p>
<p>导入三次数据：总数据量  三千五百万</p>
<h3 id="导入文件数据"><a href="#导入文件数据" class="headerlink" title="导入文件数据"></a>导入文件数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">clickhouse-client --query &quot;INSERT INTO tutorial.hits_v1 FORMAT TSV&quot; --max_insert_block_size&#x3D;100000 &lt; hits_v1.tsv</span><br><span class="line">clickhouse-client --query &quot;INSERT INTO tutorial.visits_v1 FORMAT TSV&quot; --max_insert_block_size&#x3D;100000 &lt; visits_v1.tsv</span><br></pre></td></tr></table></figure>

<p>插入块最大为100000 ，两个为200000</p>
<p>两个文件总大小 9.8G</p>
<p>cpu、内存和负载</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210410142447492.png" alt="image-20210410142447492"></p>
<p>磁盘读写</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210410142527207.png" alt="image-20210410142527207"></p>
<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>所有的查询都在本机clickhouse-client执行，排除了网络传输导致查询慢的因素</p>
<p><strong>单机</strong></p>
<p>visits_v1  5037815数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行时间 2.079s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> visits_v1 <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 18.2s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> visits_v1 hv <span class="keyword">where</span> UserID = <span class="string">'417958942509176083'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 8.137s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> visits_v1 <span class="keyword">WHERE</span> StartDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> StartDate <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">100</span>;</span><br><span class="line"><span class="comment">-- 执行时间 0.667s 查询部分列</span></span><br><span class="line"><span class="keyword">SELECT</span> CounterID,StartDate,<span class="keyword">Sign</span>,IsNew,LinkURL,StartURL,EndURL <span class="keyword">FROM</span> visits_v1 <span class="keyword">WHERE</span> StartDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> StartDate <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 官方sql示例</span></span><br><span class="line"><span class="comment">-- 执行时间 0.38s </span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    StartURL <span class="keyword">AS</span> <span class="keyword">URL</span>,</span><br><span class="line">    <span class="keyword">AVG</span>(<span class="keyword">Duration</span>) <span class="keyword">AS</span> AvgDuration</span><br><span class="line"><span class="keyword">FROM</span> tutorial.visits_v1</span><br><span class="line"><span class="keyword">WHERE</span> StartDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">URL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> AvgDuration <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span></span><br><span class="line"><span class="comment">-- 执行时间  0.036</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">sum</span>(<span class="keyword">Sign</span>) <span class="keyword">AS</span> visits,</span><br><span class="line">    sumIf(<span class="keyword">Sign</span>, has(Goals.ID, <span class="number">1105530</span>)) <span class="keyword">AS</span> goal_visits,</span><br><span class="line">    (<span class="number">100.</span> * goal_visits) / visits <span class="keyword">AS</span> goal_percent</span><br><span class="line"><span class="keyword">FROM</span> tutorial.visits_v1</span><br><span class="line"><span class="keyword">WHERE</span> (CounterID = <span class="number">912887</span>) <span class="keyword">AND</span> (toYYYYMM(StartDate) = <span class="number">201403</span>) <span class="keyword">AND</span> (<span class="keyword">domain</span>(StartURL) = <span class="string">'yandex.ru'</span>)</span><br></pre></td></tr></table></figure>

<p>hits_v1  29121694数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 执行时间 0.302s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> hits_v1 <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 1.183s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> hits_v1 hv <span class="keyword">where</span> WatchID = <span class="string">'8091123540819861613'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 38s</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> hits_v1 <span class="keyword">WHERE</span> EventDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> EventDate <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">100</span>;</span><br><span class="line"><span class="comment">-- 执行时间 10s  只查询部分列</span></span><br><span class="line"><span class="keyword">SELECT</span> EventDate,Title,CounterID,ClientIP,ClientIP6,RegionID,UserID,OS,UserAgent,<span class="keyword">URL</span>,Referer,IsRobot,IsLink <span class="keyword">FROM</span> hits_v1 <span class="keyword">WHERE</span> EventDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> EventDate <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 1.52s</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    Title <span class="keyword">AS</span> TITLE,</span><br><span class="line">    <span class="keyword">AVG</span>(Age) <span class="keyword">AS</span> AvgAge</span><br><span class="line"><span class="keyword">FROM</span> tutorial.hits_v1 hv </span><br><span class="line"><span class="keyword">WHERE</span> EventDate <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-30'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> TITLE</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> TITLE <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 执行时间 3.362s</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">sum</span>(HTTPError) <span class="keyword">AS</span> HTTPError1,</span><br><span class="line">    <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">AS</span> goal_visits,</span><br><span class="line">    (<span class="number">100.</span> * goal_visits) / <span class="keyword">SUM</span>(Age) <span class="keyword">AS</span> goal_percent</span><br><span class="line"><span class="keyword">FROM</span> tutorial.hits_v1 hv </span><br><span class="line"><span class="keyword">WHERE</span> (WatchID = <span class="string">'8091123540819861613'</span>) <span class="keyword">AND</span> (toYYYYMM(EventDate) = <span class="number">201403</span>) <span class="keyword">AND</span> (<span class="keyword">domain</span>(<span class="keyword">URL</span>) = <span class="string">'webmodelka'</span>)</span><br></pre></td></tr></table></figure>

<p>联表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL无效   4G内存不够  8G内存占用90% 执行7.7.0s</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">vv.ClickURL,</span><br><span class="line"><span class="keyword">COUNT</span>(<span class="number">1</span>),</span><br><span class="line"><span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> UserID)</span><br><span class="line"><span class="keyword">FROM</span> visits_v1 vv </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> hits_v1 hv <span class="keyword">ON</span> vv.UserID = hv.UserID </span><br><span class="line"><span class="keyword">WHERE</span> vv.ClickEventTime <span class="keyword">BETWEEN</span> <span class="string">'2014-03-23'</span> <span class="keyword">AND</span> <span class="string">'2014-03-24'</span> </span><br><span class="line"><span class="keyword">AND</span> (<span class="keyword">domain</span>(vv.ClickURL) = <span class="string">'autor.in'</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">domain</span>(hv.URL), vv.ClickURL;</span><br></pre></td></tr></table></figure>



<p><strong>模拟线上数据进行测试</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tutorial.sr_partner_used_minute (</span><br><span class="line">	partner_code UInt32,</span><br><span class="line">	resource_id UInt16,</span><br><span class="line">	resource_code <span class="keyword">String</span>,</span><br><span class="line">	resource_name <span class="keyword">String</span>,</span><br><span class="line">	idc_id UInt16,</span><br><span class="line">	idc_name <span class="keyword">String</span>,</span><br><span class="line">	idc_area_id UInt8,</span><br><span class="line">	idc_area_name <span class="keyword">String</span>,</span><br><span class="line">	total_servers UInt32,</span><br><span class="line">	online_servers UInt32,</span><br><span class="line">	restart_servers UInt32,</span><br><span class="line">	used_servers UInt32,</span><br><span class="line">	date_time DateTime,</span><br><span class="line">	created_time DateTime,</span><br><span class="line">	update_time DateTime</span><br><span class="line">) <span class="keyword">ENGINE</span>=MergeTree()</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> toDate(date_time)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (date_time, idc_id, partner_code, resource_id);</span><br></pre></td></tr></table></figure>

<p>导入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutorial.sr_partner_used_minute (partner_code, resource_id, resource_code, resource_name, idc_id, idc_name, idc_area_id, idc_area_name, total_servers, online_servers, restart_servers, used_servers, date_time, created_time, update_time) <span class="keyword">SELECT</span> partner_code, resource_id, resource_code, resource_name, idc_id, idc_name, idc_area_id, idc_area_name, total_servers, online_servers, restart_servers, used_servers, date_time, created_time, update_time <span class="keyword">FROM</span> mysql(<span class="string">'rm-bp19100z6qiyx8j43125090.mysql.rds.aliyuncs.com:3306'</span>, <span class="string">'dsom_service_datas'</span>, <span class="string">'sr_partner_used_minute_2021_03'</span>,<span class="string">'dataquantmgr'</span>, <span class="string">'DaLQng_dataquant'</span>)</span><br></pre></td></tr></table></figure>

<p>累加数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tutorial.sr_partner_used_minute (partner_code, resource_id, resource_code, resource_name, idc_id, idc_name, idc_area_id, idc_area_name, total_servers, online_servers, restart_servers, used_servers, date_time, created_time, update_time) <span class="keyword">SELECT</span> partner_code, resource_id, resource_code, resource_name, idc_id, idc_name, idc_area_id, idc_area_name, total_servers, online_servers, restart_servers, used_servers, date_time, created_time, update_time <span class="keyword">FROM</span> tutorial.sr_partner_used_minute;</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong></p>
<p>130w数据执行线上sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取使用率列表  按天每小时的    0.186s    MySQL 13.016s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name,date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_online <span class="keyword">DESC</span>, date_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -- 图表数据  按小时         0.181s    MySQL 12.426s</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(toString(partner_code),<span class="string">'--'</span>, idc_name) <span class="keyword">AS</span> partner_idc,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> partner_idc, date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> date_time,partner_idc <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源使用率TOP3        0.072s   2.457s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_used <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>500w</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取使用率列表  按天每小时的   0.626s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name,date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_online <span class="keyword">DESC</span>, date_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -- 图表数据  按小时        0.581s</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(toString(partner_code),<span class="string">'--'</span>, idc_name) <span class="keyword">AS</span> partner_idc,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> partner_idc, date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> date_time,partner_idc <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源使用率TOP3       0.229s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_used <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>1000w</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取使用率列表  按天每小时的   1.232s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name,date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_online <span class="keyword">DESC</span>, date_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -- 图表数据  按小时        1.137s</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(toString(partner_code),<span class="string">'--'</span>, idc_name) <span class="keyword">AS</span> partner_idc,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> partner_idc, date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> date_time,partner_idc <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源使用率TOP3       0.45s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_used <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>5000w</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取使用率列表  按天每小时的    6.093s </span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name,date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_online <span class="keyword">DESC</span>, date_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -- 图表数据  按小时    5.698s    </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(toString(partner_code),<span class="string">'--'</span>, idc_name) <span class="keyword">AS</span> partner_idc,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> partner_idc, date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> date_time,partner_idc <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源使用率TOP3       2.57s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_used <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>1亿</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取使用率列表  按天每小时的    12.102s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name,date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_online <span class="keyword">DESC</span>, date_time <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- -- 图表数据  按小时    11.355s</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(toString(partner_code),<span class="string">'--'</span>, idc_name) <span class="keyword">AS</span> partner_idc,</span><br><span class="line"><span class="keyword">SUBSTRING</span>(toString(date_time), <span class="number">1</span>, <span class="number">13</span>) <span class="keyword">AS</span> date_time,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute spum <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> partner_idc, date_time <span class="keyword">ORDER</span> <span class="keyword">BY</span> date_time,partner_idc <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 资源使用率TOP3     5.103s</span></span><br><span class="line"><span class="keyword">SELECT</span> idc_name,partner_code,resource_name,</span><br><span class="line">(<span class="keyword">SUM</span>(online_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_online,</span><br><span class="line">(<span class="keyword">SUM</span>(restart_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_restart,</span><br><span class="line">(<span class="keyword">SUM</span>(used_servers) / <span class="keyword">SUM</span>(total_servers)) * <span class="number">100</span> <span class="keyword">AS</span> rate_used</span><br><span class="line"><span class="keyword">FROM</span> sr_partner_used_minute <span class="keyword">WHERE</span> date_time <span class="keyword">BETWEEN</span> <span class="string">'2021-03-01 00:00:00'</span> <span class="keyword">AND</span> <span class="string">'2021-03-31 23:59:59'</span></span><br><span class="line"><span class="keyword">AND</span> idc_id != <span class="number">0</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> idc_name,partner_code,resource_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> rate_used <span class="keyword">DESC</span> <span class="keyword">LIMIT</span> <span class="number">3</span>;</span><br></pre></td></tr></table></figure>



<p>结论：</p>
<ol>
<li>clickhosue适合做宽表存储大量数据，但在查询时不建议获取所有列 ，只返回有效列</li>
<li>适合进行计算分析等操作，不适合大量查询数据记录</li>
<li>不适合点查，clickhouse的稀疏索引导致其在点查时的效率低下，查询时建议都带上分区键作为筛选条件</li>
<li>sql的执行效率会随着数据量的增长越来越低下</li>
<li>由于是单机进行的测试，如果是分布式集群的话sql效率应该会更高</li>
</ol>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Mr、 Zhao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhaoduo110.github.io/posts/de4dfb7d.html">https://zhaoduo110.github.io/posts/de4dfb7d.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhaoduo110.github.io" target="_blank">Yet</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SQL/">SQL</a><a class="post-meta__tags" href="/tags/ClickHouse/">ClickHouse</a></div><div class="post_share"><div class="social-share" data-image="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218933854.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付寶"/><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/posts/e674ae5a.html"><img class="prev_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL知识梳理-8.MySQL变量</div></div></a></div><div class="next-post pull_right"><a href="/posts/eea2a833.html"><img class="next_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL知识梳理-7.SQL优化-索引</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/43533876.html" title="ClickHouse-安装与使用"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/5a27d7aa3c85b.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-04-12</div><div class="relatedPosts_title">ClickHouse-安装与使用</div></div></a></div><div class="relatedPosts_item"><a href="/posts/c84d94b.html" title="MySQL知识梳理-1.SQL与NoSQL"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-11</div><div class="relatedPosts_title">MySQL知识梳理-1.SQL与NoSQL</div></div></a></div><div class="relatedPosts_item"><a href="/posts/ea12c5be.html" title="MySQL知识梳理-2.MySQL8.0部署"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-11</div><div class="relatedPosts_title">MySQL知识梳理-2.MySQL8.0部署</div></div></a></div><div class="relatedPosts_item"><a href="/posts/cb78f86f.html" title="MySQL知识梳理-3.MySQL配置详解及参数调优"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-16</div><div class="relatedPosts_title">MySQL知识梳理-3.MySQL配置详解及参数调优</div></div></a></div><div class="relatedPosts_item"><a href="/posts/e4264951.html" title="MySQL知识梳理-4.MySQL常用的存储引擎 & 数据类型"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-18</div><div class="relatedPosts_title">MySQL知识梳理-4.MySQL常用的存储引擎 & 数据类型</div></div></a></div><div class="relatedPosts_item"><a href="/posts/9e341d9c.html" title="MySQL知识梳理-5.SQL语言-DCL"><img class="relatedPosts_cover" data-src="https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218831023.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-03-20</div><div class="relatedPosts_title">MySQL知识梳理-5.SQL语言-DCL</div></div></a></div></div><div class="clear_both"></div></div></article></main><footer id="footer" style="background-image: url(https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/5a27d7aa3c85b.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Mr、 Zhao</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">简</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/third-party/click_heart.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script></body></html>