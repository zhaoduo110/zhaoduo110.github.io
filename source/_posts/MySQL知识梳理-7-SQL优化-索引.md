---
title: MySQL知识梳理-7.SQL优化-索引
abbrlink: eea2a833
date: 2021-03-29 09:46:15
categories:
  - - SQL
tags:
  - MySQL
  - SQL
top_img: 'https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218900853.jpg'
cover: 'https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/pic/wallpaper/1618218900853.jpg'
---



# 什么是索引

索引是帮助MySQL高效获取数据的排好序的数据结构

作用类似于新华字典或者英语字典的检字表或者也叫索引的作用一样，按照一定顺序排好序的，可以很快定位到在某一页或者直接到某一行



## 索引数据结构

-   二叉树

    在极端情况下，二叉树会变成链表，比如主键索引是递增的，在查找时无异于全表扫描

    ![image-20210419210616774](https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210419210616774.png)

-   红黑树（二叉平衡树）

    -   节点不是黑色就是红色
    -   根必须是黑色节点
    -   红色节点子节点必须是黑色节点
    -   从根到叶子节点的路径上黑色节点数量必须相等，除此之外没有其他了

    红黑树本身就没满足树的平衡规则，它是一种近似平衡的结构，它有它的一个平衡规则，对于红黑树来说只要从根到叶子节点经过相同数目的黑色节点它就认为是平衡的

    问题：红黑树的高度不可控（高度=2log(n+1)，n为节点数），当数据越来越多时，红黑树的高度会很高，在查找时扫描次数依然很多

    ![image-20210419211139886](https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210419211139886.png)



-   B-Tree（B树，不叫B-树）

    -   叶子节点具有相同的深度，叶子节点的指针为空
    -   所有索引元素不重复
    -   节点中的数据索引从左到右递增排列

    ![image-20210419212438586](https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210419212438586.png)

-   B+Tree（B+树）

    -   非叶子节点不存储data，只存储索引（冗余），可以放更多的索引
    -   叶子节点包含所有索引字段
    -   叶子节点用指针连接，提高区间访问的性能

    ![image-20210419213421306](https://could-res-1252778021.cos.ap-shanghai.myqcloud.com/img/image-20210419213421306.png) 





为什么使用B+Tree 

Hash索引的缺点和使用场景

聚集索引和非聚集索引

联合索引，最左匹配原则



Innodb的索引类型

- 普通索引
- BTree索引
  - 以B+树的结构存储索引数据
  - 适用于全值匹配(完全匹配)的查询。 class_name='mysql' 或者 class_name IN ('mysql', 'bbb') 
  - 适合处理范围查找 ：between and 、> 、<
  - 在使用联合索引时，如果只用到了联合索引中的某些而不是所有列进行匹配，则只能从索引的最左侧列开始匹配查找列，如果联合索引中的列都用到了则会忽略顺序，可以命中索引
- Hash索引
- 全文索引
- 空间索引



BTree索引的限制

- 只能从最左侧开始按索引键的顺序使用索引，不能跳过索引列
- !=、 <> (不等于) 和 NOT IN 操作无法使用索引
- 索引列上不能使用表达式或函数



复合索引的建立原则

- 区分度最高的列放在联合索引的最左侧
- 使用最频繁的列放到联合索引的最左侧
- 尽量把字段长度小的列放在联合索引的最左侧



使用索引的误区

- 索引越多越好
- 使用IN查询不能用到索引
- 查询过滤顺序必须同索引列顺序相同才可以用到索引